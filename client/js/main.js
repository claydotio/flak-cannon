(function() {
  var ConversionState, ConversionStore, ExperimentState, ExperimentStore, QueryBuilder, RecoilController, RecoilView, ResultModel, ShowState, SparkLine, isPSignificant, nMinusOneChiSquare, pFromZ,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  SparkLine = function(data) {
    var sparkline;
    sparkline = function($el, isInit) {
      var graph, palette;
      if (isInit) {
        return;
      }
      palette = new Rickshaw.Color.Palette();
      graph = new Rickshaw.Graph({
        element: $el,
        width: 100,
        height: 50,
        renderer: 'line',
        series: [
          {
            data: _.map(data, function(datum, i) {
              return {
                x: i,
                y: datum.count
              };
            }),
            color: palette.color()
          }
        ]
      });
      return graph.render();
    };
    return m('div.sparkline', {
      config: sparkline
    });
  };

  nMinusOneChiSquare = function(aConversions, aTotal, bConversions, bTotal) {
    var N, a, b, c, chi2, d, m, n, r, s, z;
    a = aConversions;
    b = aTotal - aConversions;
    c = bConversions;
    d = bTotal - bConversions;
    r = a + c;
    s = b + d;
    m = a + b;
    n = c + d;
    N = m + n + r + s;
    chi2 = Math.pow(a * d - b * c, 2) * (N - 1) / (m * n * r * s);
    z = Math.sqrt(Math.abs(chi2));
    return 1 - pFromZ(z);
  };

  pFromZ = function(z) {
    var Z_MAX, w, x, y;
    Z_MAX = 6.0;
    if (z === 0.0) {
      x = 0.0;
    } else {
      y = 0.5 * Math.abs(z);
      if (y > (Z_MAX * 0.5)) {
        x = 1.0;
      } else if (y < 1.0) {
        w = y * y;
        x = ((((((((0.000124818987 * w - 0.001075204047) * w + 0.005198775019) * w - 0.019198292004) * w + 0.059054035642) * w - 0.151968751364) * w + 0.319152932694) * w - 0.531923007300) * w + 0.797884560593) * y * 2.0;
      } else {
        y -= 2.0;
        x = (((((((((((((-0.000045255659 * y + 0.000152529290) * y - 0.000019538132) * y - 0.000676904986) * y + 0.001390604284) * y - 0.000794620820) * y - 0.002034254874) * y + 0.006549791214) * y - 0.010557625006) * y + 0.011630447319) * y - 0.009279453341) * y + 0.005353579108) * y - 0.002141268741) * y + 0.000535310849) * y + 0.999936657524;
      }
    }
    if (z > 0.0) {
      return (x + 1.0) * 0.5;
    } else {
      return (1.0 - x) * 0.5;
    }
  };

  isPSignificant = function(p) {
    return p > 0.05;
  };

  ResultModel = (function() {
    function ResultModel() {
      this.query = __bind(this.query, this);
    }

    ResultModel.prototype.transform = function(data) {
      var control;
      data = data.map(function(result) {
        result.totalConversions = _.reduce(result.data, function(sum, datum) {
          return sum + datum.count;
        }, 0);
        return result;
      });
      if (!data[0]) {
        return [];
      }
      control = data[0];
      control.p = 0;
      control.percentDelta = 0;
      data = data.slice(1).map(function(result) {
        var aConversions, aPercent, aTotal, bConversions, bPercent, bTotal, p, percentDelta;
        aConversions = result.totalConversions;
        aTotal = result.participantCount;
        bConversions = control.totalConversions;
        bTotal = control.participantCount;
        aPercent = aConversions / aTotal;
        bPercent = bConversions / bTotal;
        percentDelta = aPercent - bPercent;
        p = nMinusOneChiSquare(aConversions, aTotal, bConversions, bTotal);
        result.p = p;
        result.percentDelta = percentDelta;
        return result;
      });
      data = [control].concat(_.sortBy(data, 'percentDelta').reverse());
      return data;
    };

    ResultModel.prototype.data = (function() {
      var def;
      def = m.deferred();
      def.resolve([]);
      return def.promise;
    })();

    ResultModel.prototype.query = function(q) {
      q = _.defaults(q, {
        experiment: '',
        start: '',
        end: '',
        splits: '',
        conversion: '',
        namespace: ''
      });
      return m.request({
        method: 'GET',
        url: "/api/" + q.namespace + "/experiments/" + q.experiment + "/results\n?from=" + (moment(q.start).format('L')) + "\n&to=" + (moment(q.end).format('L')) + "\n&split=" + q.splits + "\n&conversion=" + q.conversion
      }).then(this.transform).then(this.data);
    };

    return ResultModel;

  })();

  QueryBuilder = function(queryHandler) {
    var conversion, end, experiment, namespace, query, splits, start;
    experiment = m.prop('signupText');
    start = m.prop(moment().subtract('days', 14).format('L').toString());
    end = m.prop(moment().format('L').toString());
    splits = m.prop('');
    conversion = m.prop('signUp');
    namespace = m.prop('');
    query = function() {
      return queryHandler({
        experiment: experiment(),
        start: start(),
        end: end(),
        splits: splits(),
        conversion: conversion(),
        namespace: namespace()
      });
    };
    return function() {
      return m('div', [
        m('input', {
          value: namespace(),
          placeholder: 'namespace',
          onchange: m.withAttr('value', namespace)
        }), m('input', {
          value: experiment(),
          placeholder: 'experiment',
          onchange: m.withAttr('value', experiment)
        }), m('input', {
          value: start(),
          placeholder: 'start',
          onchange: m.withAttr('value', start)
        }), m('input', {
          value: end(),
          placeholder: 'end',
          onchange: m.withAttr('value', end)
        }), m('input', {
          value: splits(),
          placeholder: 'splits (, separated)',
          onchange: m.withAttr('value', splits)
        }), m('input', {
          value: conversion(),
          placeholder: 'conversion',
          onchange: m.withAttr('value', conversion)
        }), m('button', {
          onclick: query
        }, 'go')
      ]);
    };
  };

  ExperimentStore = (function() {
    var data;
    data = m.request({
      method: 'GET',
      url: '/api/experiments'
    });
    return {
      getAll: function() {
        return data;
      }
    };
  })();

  ConversionStore = (function() {
    var data;
    data = m.request({
      method: 'GET',
      url: '/api/conversions/uniq'
    });
    return {
      getAll: function() {
        return data;
      }
    };
  })();

  ExperimentState = function(experiments) {
    return m('ul', experiments.map(function(experiment) {
      return m('li', [
        experiment.name + (" (" + experiment.namespace + ")"), m('ul', experiment.values.map(function(val) {
          return m('li', val);
        }))
      ]);
    }));
  };

  ConversionState = function(conversions) {
    return m('ul', conversions.map(function(conversion) {
      return m('li', conversion.name + (" (" + conversion.namespace + ")"));
    }));
  };

  ShowState = function(experiments, conversions) {
    return ['Experiments', ExperimentState(experiments), 'Conversions', ConversionState(conversions)];
  };

  RecoilController = function() {
    var results;
    results = new ResultModel;
    return {
      results: results,
      experiments: ExperimentStore.getAll(),
      conversions: ConversionStore.getAll(),
      queryBuilder: QueryBuilder(results.query)
    };
  };

  RecoilView = function(ctrl) {
    var percent, results, titles;
    results = ctrl.results.data() || [];
    titles = ['test', 'sparkline'].concat(results[0] ? _.keys(results[0].splits) : void 0).concat(['conversions', 'participants', 'percent', 'p < 0.05', 'delta']);
    percent = function(n) {
      return (n * 100).toFixed(2) + '%';
    };
    return [
      ShowState(ctrl.experiments(), ctrl.conversions()), m('br'), ctrl.queryBuilder(), m('br'), !results.length ? 'NO RESULTS' : void 0, m('table', titles.map(m.bind(m, 'th')).concat(_.map(_.values(results), function(result) {
        var color;
        color = result.percentDelta > 0 ? 'green' : result.percentDelta === 0 ? 'black' : 'red';
        return m('tr', [m('td', result.test), m('td', [SparkLine(result.data)])].concat(_.map(_.values(result.splits), m.bind(m, 'td'))).concat([
          m('td', result.totalConversions), m('td', result.participantCount), m('td', percent(result.totalConversions / result.participantCount)), m('td', result.p.toFixed(3)), m('td', {
            style: {
              color: color
            }
          }, percent(result.percentDelta))
        ]));
      })))
    ];
  };

  m.module(document.getElementById('recoil'), {
    controller: RecoilController,
    view: RecoilView
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,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QUYsQ0FBTSxDQUFDLENBQUMsTUFBRixDQUFTLE1BQU0sQ0FBQyxNQUFoQixDQUFOLEVBQStCLENBQUMsQ0FBQyxJQUFGLENBQU8sQ0FBUCxFQUFVLElBQVYsQ0FBL0IsQ0FKTyxDQUtmLENBQUMsTUFMYyxDQUtQO1VBQ04sQ0FBQSxDQUFFLElBQUYsRUFBUSxNQUFNLENBQUMsZ0JBQWYsQ0FETSxFQUVOLENBQUEsQ0FBRSxJQUFGLEVBQVEsTUFBTSxDQUFDLGdCQUFmLENBRk0sRUFHTixDQUFBLENBQUUsSUFBRixFQUFRLE9BQUEsQ0FBUSxNQUFNLENBQUMsZ0JBQVAsR0FBMEIsTUFBTSxDQUFDLGdCQUF6QyxDQUFSLENBSE0sRUFJTixDQUFBLENBQUUsSUFBRixFQUFRLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBVCxDQUFpQixDQUFqQixDQUFSLENBSk0sRUFLTixDQUFBLENBQUUsSUFBRixFQUFRO0FBQUEsWUFBQSxLQUFBLEVBQU87QUFBQSxjQUFBLEtBQUEsRUFBTyxLQUFQO2FBQVA7V0FBUixFQUE2QixPQUFBLENBQVEsTUFBTSxDQUFDLFlBQWYsQ0FBN0IsQ0FMTTtTQUxPLENBQVIsQ0FBUCxDQUorQjtNQUFBLENBQXpCLENBREcsQ0FBWCxDQU5LO0tBQVAsQ0FWVztFQUFBLENBblBiLENBQUE7O0FBQUEsRUF1UkEsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxRQUFRLENBQUMsY0FBVCxDQUF3QixRQUF4QixDQUFULEVBQ1E7QUFBQSxJQUFDLFVBQUEsRUFBWSxnQkFBYjtBQUFBLElBQStCLElBQUEsRUFBTSxVQUFyQztHQURSLENBdlJBLENBQUE7QUFBQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiU3BhcmtMaW5lID0gKGRhdGEpIC0+XG4gIHNwYXJrbGluZSA9ICgkZWwsIGlzSW5pdCkgLT5cbiAgICBpZiBpc0luaXRcbiAgICAgIHJldHVyblxuXG4gICAgcGFsZXR0ZSA9IG5ldyBSaWNrc2hhdy5Db2xvci5QYWxldHRlKClcbiAgICBncmFwaCA9IG5ldyBSaWNrc2hhdy5HcmFwaFxuICAgICAgZWxlbWVudDogJGVsXG4gICAgICB3aWR0aDogMTAwXG4gICAgICBoZWlnaHQ6IDUwXG4gICAgICByZW5kZXJlcjogJ2xpbmUnXG4gICAgICBzZXJpZXM6IFtcbiAgICAgICAgZGF0YTogXy5tYXAoZGF0YSwgKGRhdHVtLCBpKSAtPlxuICAgICAgICAgIHg6IGlcbiAgICAgICAgICB5OiBkYXR1bS5jb3VudFxuICAgICAgICApXG4gICAgICAgIGNvbG9yOiBwYWxldHRlLmNvbG9yKClcbiAgICAgIF1cblxuICAgIGdyYXBoLnJlbmRlcigpXG5cbiAgbSAnZGl2LnNwYXJrbGluZScsIHtjb25maWc6IHNwYXJrbGluZX1cblxuIyBEZXRlcm1pbmUgaWYgdHdvIHZhbHVlcyBhcmUgc3RhdGlzdGljYWxseSBkaWZmZXJlbnRcbiMgcmV0dXJucyB0aGUgcC12YWx1ZVxuI1xuIyBodHRwOi8vd3d3LmlhbmNhbXBiZWxsLmNvLnVrL3R3b2J5dHdvL24tMV90aGVvcnkuaHRtXG4jIEIgaXMgc3VjY2Vzc2Z1bCBjb252ZXJpb25zXG4jIG5vdC1CIGlzIHVuc3VjY2Vzc2Z1bCBjb252ZXJzaW9uc1xuIyBBIGlzIHRlc3QgMVxuIyBub3QtQSBpcyB0ZXN0IDJcbiNcbiMgZm9ybXVsYVxuIyAoYSpkIC0gYipjKSoqMiAqIChOIC0xKSAvIChtKm4qcipzKVxuI1xuIyAgICAgICAgICBCICBub3QtQiAgVG90YWxcbiMgQSAgICAgfCAgYSAgICBiICAgICAgbVxuIyBub3QtQSB8ICBjICAgIGQgICAgICBuXG4jIFRvdGFsIHwgIHIgICAgcyAgICAgIE5cbiNcbm5NaW51c09uZUNoaVNxdWFyZSA9IChhQ29udmVyc2lvbnMsIGFUb3RhbCwgYkNvbnZlcnNpb25zLCBiVG90YWwpIC0+XG4gIGEgPSBhQ29udmVyc2lvbnNcbiAgYiA9IGFUb3RhbCAtIGFDb252ZXJzaW9uc1xuICBjID0gYkNvbnZlcnNpb25zXG4gIGQgPSBiVG90YWwgLSBiQ29udmVyc2lvbnNcblxuICByID0gYSArIGNcbiAgcyA9IGIgKyBkXG4gIG0gPSBhICsgYlxuICBuID0gYyArIGRcbiAgTiA9IG0gKyBuICsgciArIHNcblxuICBjaGkyID0gKGEqZCAtIGIqYykqKjIgKiAoTiAtIDEpIC8gKG0qbipyKnMpXG4gIHogPSBNYXRoLnNxcnQoTWF0aC5hYnMoY2hpMikpXG4gIDEgLSBwRnJvbVooeilcblxucEZyb21aID0gKHopIC0+XG4gIFpfTUFYID0gNi4wXG5cbiAgaWYgeiA9PSAwLjBcbiAgICB4ID0gMC4wXG4gIGVsc2VcbiAgICB5ID0gMC41ICogTWF0aC5hYnMoeilcbiAgICBpZiB5ID4gKFpfTUFYICogMC41KVxuICAgICAgeCA9IDEuMFxuICAgIGVsc2UgaWYgeSA8IDEuMFxuICAgICAgdyA9IHkgKiB5XG4gICAgICB4ID0gKCgoKCgoKCgwLjAwMDEyNDgxODk4NyAqIHcgLVxuICAgICAgICAgICAgICAgICAgMC4wMDEwNzUyMDQwNDcpICogdyArIDAuMDA1MTk4Nzc1MDE5KSAqIHcgLVxuICAgICAgICAgICAgICAgICAgMC4wMTkxOTgyOTIwMDQpICogdyArIDAuMDU5MDU0MDM1NjQyKSAqIHcgLVxuICAgICAgICAgICAgICAgICAgMC4xNTE5Njg3NTEzNjQpICogdyArIDAuMzE5MTUyOTMyNjk0KSAqIHcgLVxuICAgICAgICAgICAgICAgICAgMC41MzE5MjMwMDczMDApICogdyArIDAuNzk3ODg0NTYwNTkzKSAqIHkgKiAyLjBcbiAgICBlbHNlXG4gICAgICB5IC09IDIuMFxuICAgICAgeCA9ICgoKCgoKCgoKCgoKCgtMC4wMDAwNDUyNTU2NTkgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwMTUyNTI5MjkwKSAqIHkgLSAwLjAwMDAxOTUzODEzMikgKiB5IC1cbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwNjc2OTA0OTg2KSAqIHkgKyAwLjAwMTM5MDYwNDI4NCkgKiB5IC1cbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwNzk0NjIwODIwKSAqIHkgLSAwLjAwMjAzNDI1NDg3NCkgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDA2NTQ5NzkxMjE0KSAqIHkgLSAwLjAxMDU1NzYyNTAwNikgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDExNjMwNDQ3MzE5KSAqIHkgLSAwLjAwOTI3OTQ1MzM0MSkgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDA1MzUzNTc5MTA4KSAqIHkgLSAwLjAwMjE0MTI2ODc0MSkgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwNTM1MzEwODQ5KSAqIHkgKyAwLjk5OTkzNjY1NzUyNFxuICBpZiB6ID4gMC4wIHRoZW4gKCh4ICsgMS4wKSAqIDAuNSkgZWxzZSAoKDEuMCAtIHgpICogMC41KVxuXG5pc1BTaWduaWZpY2FudCA9IChwKSAtPlxuICBwID4gMC4wNVxuXG5jbGFzcyBSZXN1bHRNb2RlbFxuICB0cmFuc2Zvcm06KGRhdGEpIC0+XG5cbiAgICAjIGNvdW50IHRvdGFsIGNvbnZlcnNpb25zXG4gICAgZGF0YSA9IGRhdGEubWFwIChyZXN1bHQpIC0+XG4gICAgICByZXN1bHQudG90YWxDb252ZXJzaW9ucyA9IF8ucmVkdWNlKHJlc3VsdC5kYXRhLCAoc3VtLCBkYXR1bSkgLT5cbiAgICAgICAgc3VtICsgZGF0dW0uY291bnRcbiAgICAgICwgMClcbiAgICAgIHJldHVybiByZXN1bHRcblxuICAgICMgY2FsY3VsYXRlIHAtdmFsdWUgYW5kIHBlcmNlbnRhZ2UgY2hhbmdlIGFnYWluc3QgdGhlIGZpcnN0IHJlc3VsdFxuICAgIGlmICFkYXRhWzBdXG4gICAgICByZXR1cm4gW11cbiAgICBjb250cm9sID0gZGF0YVswXVxuICAgIGNvbnRyb2wucCA9IDBcbiAgICBjb250cm9sLnBlcmNlbnREZWx0YSA9IDBcblxuICAgIGRhdGEgPSBkYXRhLnNsaWNlKDEpLm1hcCAocmVzdWx0KSAtPlxuICAgICAgYUNvbnZlcnNpb25zID0gcmVzdWx0LnRvdGFsQ29udmVyc2lvbnNcbiAgICAgIGFUb3RhbCA9IHJlc3VsdC5wYXJ0aWNpcGFudENvdW50XG4gICAgICBiQ29udmVyc2lvbnMgPSBjb250cm9sLnRvdGFsQ29udmVyc2lvbnNcbiAgICAgIGJUb3RhbCA9IGNvbnRyb2wucGFydGljaXBhbnRDb3VudFxuXG4gICAgICBhUGVyY2VudCA9IGFDb252ZXJzaW9ucyAvIGFUb3RhbFxuICAgICAgYlBlcmNlbnQgPSBiQ29udmVyc2lvbnMgLyBiVG90YWxcbiAgICAgIHBlcmNlbnREZWx0YSA9IGFQZXJjZW50IC0gYlBlcmNlbnRcblxuICAgICAgcCA9IG5NaW51c09uZUNoaVNxdWFyZShcbiAgICAgICAgYUNvbnZlcnNpb25zLFxuICAgICAgICBhVG90YWwsXG4gICAgICAgIGJDb252ZXJzaW9ucyxcbiAgICAgICAgYlRvdGFsKVxuXG4gICAgICByZXN1bHQucCA9IHBcbiAgICAgIHJlc3VsdC5wZXJjZW50RGVsdGEgPSBwZXJjZW50RGVsdGFcblxuICAgICAgcmV0dXJuIHJlc3VsdFxuXG4gICAgZGF0YSA9IFtjb250cm9sXS5jb25jYXQgXy5zb3J0QnkoZGF0YSwgJ3BlcmNlbnREZWx0YScpLnJldmVyc2UoKVxuICAgIHJldHVybiBkYXRhXG5cblxuICBkYXRhOiBkbyAtPlxuICAgIGRlZiA9IG0uZGVmZXJyZWQoKVxuICAgIGRlZi5yZXNvbHZlKFtdKVxuICAgIGRlZi5wcm9taXNlXG4gIHF1ZXJ5OiAocSkgPT5cbiAgICBxID0gXy5kZWZhdWx0cyBxLFxuICAgICAgIGV4cGVyaW1lbnQ6ICcnXG4gICAgICAgc3RhcnQ6ICcnXG4gICAgICAgZW5kOiAnJ1xuICAgICAgIHNwbGl0czogJydcbiAgICAgICBjb252ZXJzaW9uOiAnJ1xuICAgICAgIG5hbWVzcGFjZTogJydcblxuICAgIG0ucmVxdWVzdFxuICAgICAgbWV0aG9kOiAnR0VUJ1xuICAgICAgdXJsOiBcIlwiXCIvYXBpLyN7cS5uYW1lc3BhY2V9L2V4cGVyaW1lbnRzLyN7cS5leHBlcmltZW50fS9yZXN1bHRzXG4gICAgICAgID9mcm9tPSN7bW9tZW50KHEuc3RhcnQpLmZvcm1hdCgnTCcpfVxuICAgICAgICAmdG89I3ttb21lbnQocS5lbmQpLmZvcm1hdCgnTCcpfVxuICAgICAgICAmc3BsaXQ9I3txLnNwbGl0c31cbiAgICAgICAgJmNvbnZlcnNpb249I3txLmNvbnZlcnNpb259XCJcIlwiXG4gICAgLnRoZW4oQHRyYW5zZm9ybSkudGhlbihAZGF0YSlcblxuUXVlcnlCdWlsZGVyID0gKHF1ZXJ5SGFuZGxlcikgLT5cbiAgZXhwZXJpbWVudCA9IG0ucHJvcCAnc2lnbnVwVGV4dCdcbiAgc3RhcnQgPSBtLnByb3AgbW9tZW50KCkuc3VidHJhY3QoJ2RheXMnLCAxNCkuZm9ybWF0KCdMJykudG9TdHJpbmcoKVxuICBlbmQgPSBtLnByb3AgbW9tZW50KCkuZm9ybWF0KCdMJykudG9TdHJpbmcoKVxuICBzcGxpdHMgPSBtLnByb3AgJydcbiAgY29udmVyc2lvbiA9IG0ucHJvcCAnc2lnblVwJ1xuICBuYW1lc3BhY2UgPSBtLnByb3AgJydcblxuICBxdWVyeSA9IC0+XG4gICAgcXVlcnlIYW5kbGVyXG4gICAgICBleHBlcmltZW50OiBleHBlcmltZW50KClcbiAgICAgIHN0YXJ0OiBzdGFydCgpXG4gICAgICBlbmQ6IGVuZCgpXG4gICAgICBzcGxpdHM6IHNwbGl0cygpLFxuICAgICAgY29udmVyc2lvbjogY29udmVyc2lvbigpXG4gICAgICBuYW1lc3BhY2U6IG5hbWVzcGFjZSgpXG5cbiAgLT5cbiAgICBtICdkaXYnLCBbXG4gICAgICBtICdpbnB1dCcsXG4gICAgICAgIHZhbHVlOiBuYW1lc3BhY2UoKVxuICAgICAgICBwbGFjZWhvbGRlcjogJ25hbWVzcGFjZSdcbiAgICAgICAgb25jaGFuZ2U6IG0ud2l0aEF0dHIoJ3ZhbHVlJywgbmFtZXNwYWNlKVxuICAgICAgbSAnaW5wdXQnLFxuICAgICAgICB2YWx1ZTogZXhwZXJpbWVudCgpXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnZXhwZXJpbWVudCdcbiAgICAgICAgb25jaGFuZ2U6IG0ud2l0aEF0dHIoJ3ZhbHVlJywgZXhwZXJpbWVudClcbiAgICAgIG0gJ2lucHV0JyxcbiAgICAgICAgdmFsdWU6IHN0YXJ0KClcbiAgICAgICAgcGxhY2Vob2xkZXI6ICdzdGFydCdcbiAgICAgICAgb25jaGFuZ2U6IG0ud2l0aEF0dHIoJ3ZhbHVlJywgc3RhcnQpXG4gICAgICBtICdpbnB1dCcsXG4gICAgICAgIHZhbHVlOiBlbmQoKVxuICAgICAgICBwbGFjZWhvbGRlcjogJ2VuZCdcbiAgICAgICAgb25jaGFuZ2U6IG0ud2l0aEF0dHIoJ3ZhbHVlJywgZW5kKVxuICAgICAgbSAnaW5wdXQnLFxuICAgICAgICB2YWx1ZTogc3BsaXRzKClcbiAgICAgICAgcGxhY2Vob2xkZXI6ICdzcGxpdHMgKCwgc2VwYXJhdGVkKSdcbiAgICAgICAgb25jaGFuZ2U6IG0ud2l0aEF0dHIoJ3ZhbHVlJywgc3BsaXRzKVxuICAgICAgbSAnaW5wdXQnLFxuICAgICAgICB2YWx1ZTogY29udmVyc2lvbigpXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnY29udmVyc2lvbidcbiAgICAgICAgb25jaGFuZ2U6IG0ud2l0aEF0dHIoJ3ZhbHVlJywgY29udmVyc2lvbilcbiAgICAgIG0gJ2J1dHRvbicsXG4gICAgICAgIG9uY2xpY2s6IHF1ZXJ5LFxuICAgICAgICAnZ28nXG4gICAgXVxuXG5FeHBlcmltZW50U3RvcmUgPSBkbyAtPlxuICBkYXRhID0gbS5yZXF1ZXN0XG4gICAgbWV0aG9kOiAnR0VUJ1xuICAgIHVybDogJy9hcGkvZXhwZXJpbWVudHMnXG5cbiAgZ2V0QWxsOiAtPlxuICAgIGRhdGFcblxuQ29udmVyc2lvblN0b3JlID0gZG8gLT5cbiAgZGF0YSA9IG0ucmVxdWVzdFxuICAgIG1ldGhvZDogJ0dFVCdcbiAgICB1cmw6ICcvYXBpL2NvbnZlcnNpb25zL3VuaXEnXG5cbiAgZ2V0QWxsOiAtPlxuICAgIGRhdGFcblxuRXhwZXJpbWVudFN0YXRlID0gKGV4cGVyaW1lbnRzKSAtPlxuICBtICd1bCcsIGV4cGVyaW1lbnRzLm1hcCAoZXhwZXJpbWVudCkgLT5cbiAgICBtICdsaScsIFtcbiAgICAgIGV4cGVyaW1lbnQubmFtZSArIFwiICgje2V4cGVyaW1lbnQubmFtZXNwYWNlfSlcIixcbiAgICAgIG0gJ3VsJyxcbiAgICAgICAgZXhwZXJpbWVudC52YWx1ZXMubWFwICh2YWwpIC0+XG4gICAgICAgICAgbSAnbGknLCB2YWxcbiAgICBdXG5cbkNvbnZlcnNpb25TdGF0ZSA9IChjb252ZXJzaW9ucykgLT5cbiAgbSAndWwnLCBjb252ZXJzaW9ucy5tYXAgKGNvbnZlcnNpb24pIC0+XG4gICAgbSAnbGknLCBjb252ZXJzaW9uLm5hbWUgKyBcIiAoI3tjb252ZXJzaW9uLm5hbWVzcGFjZX0pXCJcblxuU2hvd1N0YXRlID0gKGV4cGVyaW1lbnRzLCBjb252ZXJzaW9ucykgLT5cbiAgW1xuICAgICdFeHBlcmltZW50cycsXG4gICAgRXhwZXJpbWVudFN0YXRlKGV4cGVyaW1lbnRzKSxcbiAgICAnQ29udmVyc2lvbnMnLFxuICAgIENvbnZlcnNpb25TdGF0ZShjb252ZXJzaW9ucylcbiAgXVxuXG5SZWNvaWxDb250cm9sbGVyID0gLT5cbiAgcmVzdWx0cyA9IG5ldyBSZXN1bHRNb2RlbFxuICByZXN1bHRzOiByZXN1bHRzXG4gIGV4cGVyaW1lbnRzOiBFeHBlcmltZW50U3RvcmUuZ2V0QWxsKClcbiAgY29udmVyc2lvbnM6IENvbnZlcnNpb25TdG9yZS5nZXRBbGwoKVxuICBxdWVyeUJ1aWxkZXI6IFF1ZXJ5QnVpbGRlcihyZXN1bHRzLnF1ZXJ5KVxuXG5SZWNvaWxWaWV3ID0gKGN0cmwpIC0+XG4gIHJlc3VsdHMgPSBjdHJsLnJlc3VsdHMuZGF0YSgpIG9yIFtdXG4gIHRpdGxlcyA9IFsndGVzdCcsICdzcGFya2xpbmUnXVxuICAgIC5jb25jYXQoaWYgcmVzdWx0c1swXSB0aGVuIF8ua2V5cyhyZXN1bHRzWzBdLnNwbGl0cykpXG4gICAgLmNvbmNhdChbJ2NvbnZlcnNpb25zJywgJ3BhcnRpY2lwYW50cycsXG4gICAgICAgICAgICAgJ3BlcmNlbnQnLCAncCA8IDAuMDUnLCAnZGVsdGEnXSlcblxuICBwZXJjZW50ID0gKG4pIC0+XG4gICAgKG4gKiAxMDApLnRvRml4ZWQoMikgKyAnJSdcblxuICByZXR1cm4gW1xuICAgIFNob3dTdGF0ZShjdHJsLmV4cGVyaW1lbnRzKCksIGN0cmwuY29udmVyc2lvbnMoKSlcbiAgICBtICdicidcbiAgICBjdHJsLnF1ZXJ5QnVpbGRlcigpXG4gICAgbSAnYnInXG4gICAgdW5sZXNzIHJlc3VsdHMubGVuZ3RoIHRoZW4gJ05PIFJFU1VMVFMnXG4gICAgbSgndGFibGUnLCB0aXRsZXMubWFwKG0uYmluZChtLCAndGgnKSlcbiAgICAuY29uY2F0KF8ubWFwKF8udmFsdWVzKHJlc3VsdHMpLCAocmVzdWx0KSAtPlxuICAgICAgY29sb3IgPSBpZiByZXN1bHQucGVyY2VudERlbHRhID4gMCB0aGVuICdncmVlbicgZWxzZVxuICAgICAgICAgICAgICBpZiByZXN1bHQucGVyY2VudERlbHRhID09IDAgdGhlbiAnYmxhY2snIGVsc2UgJ3JlZCdcblxuICAgICAgcmV0dXJuIG0oJ3RyJywgW1xuICAgICAgICBtKCd0ZCcsIHJlc3VsdC50ZXN0KSxcbiAgICAgICAgbSgndGQnLCBbU3BhcmtMaW5lKHJlc3VsdC5kYXRhKV0pXG4gICAgICBdXG4gICAgICAuY29uY2F0KF8ubWFwKF8udmFsdWVzKHJlc3VsdC5zcGxpdHMpLCBtLmJpbmQobSwgJ3RkJykgKSlcbiAgICAgIC5jb25jYXQoW1xuICAgICAgICBtICd0ZCcsIHJlc3VsdC50b3RhbENvbnZlcnNpb25zXG4gICAgICAgIG0gJ3RkJywgcmVzdWx0LnBhcnRpY2lwYW50Q291bnRcbiAgICAgICAgbSAndGQnLCBwZXJjZW50IHJlc3VsdC50b3RhbENvbnZlcnNpb25zIC8gcmVzdWx0LnBhcnRpY2lwYW50Q291bnRcbiAgICAgICAgbSAndGQnLCByZXN1bHQucC50b0ZpeGVkKDMpXG4gICAgICAgIG0gJ3RkJywgc3R5bGU6IGNvbG9yOiBjb2xvciwgcGVyY2VudCByZXN1bHQucGVyY2VudERlbHRhXG4gICAgICBdKSlcbiAgICApKSlcbiAgXVxuXG5tLm1vZHVsZSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVjb2lsJyksXG4gICAgICAgIHtjb250cm9sbGVyOiBSZWNvaWxDb250cm9sbGVyLCB2aWV3OiBSZWNvaWxWaWV3fVxuIl19